@{
    ViewBag.Title = "Home Page";


}
@model List<LunBo>
<div class="top_done">
    <div class="flexs top_done_body">
        <div class="itmes">
            <img src="~/images/users/right_1.png" alt="图片显示异常" width="200" />
        </div>
        <div class="itmes">
            <input type="text" name="name" placeholder=" 搜二手 出二手 淘二手" class="sousuo" id="sousuo1" /><input type="button" name="name" onclick="getdata_ajax()" value="搜索" class="anniu" />
        </div>
        <div class="itmes">
            <a href="/Goods/Release" class="play">免费发布二手产品信息</a>
        </div>
    </div>
</div>

<div id="myCarousel" class="carousel slide rowmagre">
    <!-- 轮播（Carousel）指标 -->
    <ol class="carousel-indicators">
        @for (int i = 0; i < Model.Count(); i++)
        {
            if (i == 0)
            {
                <li data-target="#myCarousel" data-slide-to="@i" class="active"></li>
            }
            else
            {
                <li data-target="#myCarousel" data-slide-to="@i"></li>
            }
        }
    </ol>
    <!-- 轮播（Carousel）项目 -->
    <div class="carousel-inner" style="height:300px">
        @for (int i = 0; i < Model.Count(); i++)
        {
            if (i == 0)
            {
                <div class="item active">
                    <a href="@Model[i].a_1" class="a_full">
                        <img src="~/images/users/@Model[i].images" alt="xxx图片显示错误" title="@Model[i].a_1" class="lunbo_img" />
                    </a>
                </div>
            }
            else
            {
                <div class="item">
                    <a href="@Model[i].a_1" class="a_full">
                        <img src="~/images/users/@Model[i].images" alt="xxx图片显示错误" title="@Model[i].a_1" class="lunbo_img" />
                    </a>
                </div>
            }
        }
    </div>
    <!-- 轮播（Carousel）导航 -->
    <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
        <span class="svg_1">
            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
        </span>
        <span class="sr-only">上一个</span>
    </a>
    <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
        <span class="svg_1" style="margin-top:125px;">
            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
        </span>
        <span class="sr-only">下一个</span>
    </a>
</div>

<div class=" rowmagre rowmagre_father">
    <div class="rowmagre_1">
        <a href="/Goods/IndexTwo?typeid=1&page=1$Name=''">
            电脑
        </a>
    </div>
    <div class="rowmagre_1">
        <a href="/Goods/IndexTwo?typeid=2&page=1$Name=''">
            手机平板
        </a>
    </div>
    <div class="rowmagre_1">
        <a href="/Goods/IndexTwo?typeid=3&page=1$Name=''">
            办公用品
        </a>
    </div>
    <div class="rowmagre_1">
        <a href="/Goods/IndexTwo?typeid=4&page=1$Name=''">
            数码产品
        </a>
    </div>
    <div class="rowmagre_1">
        <a href="/Goods/IndexTwo?typeid=5&page=1$Name=''">
            生活用品
        </a>
    </div>
    <div class="rowmagre_1">
        <a href="/Goods/IndexTwo?typeid=6&page=1$Name=''">
            图书
        </a>
    </div>
    <div class="rowmagre_1">
        <a href="/Goods/IndexTwo?typeid=7&page=1$Name=''">
            虚拟道具
        </a>
    </div>
    <div class="rowmagre_1">
        <a href="/Goods/IndexTwo?typeid=8&page=1$Name=''">
            其他
        </a>
    </div>
</div>


<div class="pubu-container">
    <div class="item" id="pubu-01">
    </div>
    <div class="item" id="pubu-02">
    </div>
    <div class="item" id="pubu-03">
    </div>
    <div class="item" id="pubu-04">
    </div>
</div>
<div class="div_dixian">
    <a href="#" class="a_full a_dixian">
        你已经触碰到我底线了
        <span class="svg_1">
            <svg t="1592296482519" class="icon" viewBox="0 0 1286 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7001" id="mx_n_1592296482523" width="32" height="32"><path d="M642.936409 1002.75893A545.963045 545.963045 0 0 1 97.723932 457.39634V42.48244a21.316127 21.316127 0 0 1 21.316127-21.166013h1047.942814a21.316127 21.316127 0 0 1 21.316126 21.316126v414.763787A545.963045 545.963045 0 0 1 642.936409 1002.75893z" fill="#CCECEC" p-id="7002"></path><path d="M1166.982873 42.48244v414.9139a525.397486 525.397486 0 0 1-524.046464 524.046464 525.397486 525.397486 0 0 1-523.89635-524.046464V42.48244h1047.942814m0-42.48214H119.040059a42.48214 42.48214 0 0 0-42.632253 42.48214v414.9139a566.528603 566.528603 0 0 0 1133.20732 0V42.48244A42.48214 42.48214 0 0 0 1166.982873 0.0003z" fill="#00AF9A" p-id="7003"></path><path d="M448.239112 964.780198a21.46624 21.46624 0 0 1-7.956019-1.501136 543.861455 543.861455 0 0 1-342.559161-505.882722v-2.251704A21.316127 21.316127 0 0 1 125.945283 435.329646c75.056784 26.119761 180.136281 74.005989 258.345449 153.716293 99.225068 100.726204 127.446419 222.16808 84.213712 361.023129a21.166013 21.166013 0 0 1-20.265332 15.011357z" fill="#A4DCD4" p-id="7004"></path><path d="M119.040059 455.144636c134.051416 47.13566 423.32026 186.441051 329.199053 488.469549A525.397486 525.397486 0 0 1 119.040059 457.39634v-2.251704m0-42.482139a42.48214 42.48214 0 0 0-42.48214 42.482139v2.251704a565.027468 565.027468 0 0 0 355.919269 525.397486 42.48214 42.48214 0 0 0 56.592814-26.870329c45.03407-145.009706 15.011357-277.109645-90.06814-382.339256C318.090649 491.322006 210.158994 441.784529 133.000621 414.9142a42.48214 42.48214 0 0 0-14.110676-2.401817z" fill="#00AF9A" p-id="7005"></path><path d="M837.783819 964.780198a21.166013 21.166013 0 0 1-20.265331-15.011357c-43.232707-139.005163-15.011357-260.447039 84.213711-361.02313 78.509396-79.710304 183.739006-127.596532 258.195336-153.416065a21.316127 21.316127 0 0 1 28.371464 20.115218v2.251703a543.861455 543.861455 0 0 1-342.55916 505.882722 21.46624 21.46624 0 0 1-7.95602 1.200909z" fill="#A4DCD4" p-id="7006"></path><path d="M1166.982873 455.144636v2.251704a525.397486 525.397486 0 0 1-329.199054 486.067731c-94.121207-302.028498 195.147638-441.333888 329.199054-488.469548m0-42.48214a42.48214 42.48214 0 0 0-14.110676 2.401817c-76.557919 26.870329-185.090029 76.257692-266.451582 158.820155-103.578361 105.079497-135.102211 237.32955-90.06814 382.339256a42.48214 42.48214 0 0 0 56.592815 26.870328 565.027468 565.027468 0 0 0 355.919268-525.397485v-2.251704a42.48214 42.48214 0 0 0-42.48214-42.48214z" fill="#00AF9A" p-id="7007"></path><path d="M21.316127 174.132038m21.316126 0l305.631223 0q21.316127 0 21.316127 21.316127l0 130.899031q0 21.316127-21.316127 21.316126l-305.631223 0q-21.316127 0-21.316126-21.316126l0-130.899031q0-21.316127 21.316126-21.316127Z" fill="#F8C10B" p-id="7008"></path><path d="M348.263476 195.147938v131.049144H42.48214V195.147938H348.263476m0-42.48214H42.48214A42.48214 42.48214 0 0 0 0 195.147938v131.049144a42.48214 42.48214 0 0 0 42.48214 42.48214H348.263476a42.48214 42.48214 0 0 0 42.031799-42.332026V195.147938a42.48214 42.48214 0 0 0-42.482139-42.48214z" fill="#00AF9A" p-id="7009"></path><path d="M916.443329 174.132038m21.316126 0l305.631223 0q21.316127 0 21.316127 21.316127l0 130.899031q0 21.316127-21.316127 21.316126l-305.631223 0q-21.316127 0-21.316126-21.316126l0-130.899031q0-21.316127 21.316126-21.316127Z" fill="#F8C10B" p-id="7010"></path><path d="M1243.390678 195.147938v131.049144H937.759455V195.147938h305.631223m0-42.48214H937.759455A42.48214 42.48214 0 0 0 895.277316 195.147938v131.049144a42.48214 42.48214 0 0 0 42.482139 42.48214h305.631223a42.48214 42.48214 0 0 0 42.48214-42.48214V195.147938a42.48214 42.48214 0 0 0-42.48214-42.48214z" fill="#00AF9A" p-id="7011"></path></svg>
        </span>
    </a>
</div>

<script>
    //屏幕默认大小,初始化图片的占用位置
    var windowHeight = window.screen.height + 500;
    var imgId = 0;

    var goods = {};//用来存储后台商品数据
    var images = "";//用来存储后台商品图片数据

    window.onload = function () {

        getdata_ajax();
        //var msg = jQuery.parseJSON(goods);//那以后每次用的收都将goods转化为这个形式
        //this.console.log('msg:' + msg.length);
        insertImg();
        //监听滚动事件
        window.document.addEventListener("scroll", function () {
            var msg = jQuery.parseJSON(goods);//那以后每次用的收都将goods转化为这个形式
            //document.documentElement.scrollTop:已经滚动的内容高度
            //window.screen.height: 窗口高度
            //document.documentElement.scrollHeight:能滚动的最大高度
            if (document.documentElement.scrollTop + window.screen.height > document.documentElement.scrollHeight && msg.length >= imgId) {
                //再此插入图片
                windowHeight += 500;
                insertImg();
            }

            //回到顶部的滚动监听
            if (document.documentElement.scrollTop < 500) {
                //console.log(document.documentElement.scrollTop);
                $("#toplan").hide("slow");
            } else {
                //console.log(document.documentElement.scrollTop);
                $("#toplan").show("slow");
            }
        });
    }
    //获取后台数据，ajax
    var getdata_ajax = function () {
        clerling();
        var name = "";
        if ($('#sousuo1').val() != null) {
            name = $('#sousuo1').val();
        };
        $.ajax({
            type: "get",
            data: {},
            dataType: "JSON",
            async: false,//不异步请求，加载了数据成功后在填入框中
            url: "/Home/getdata_ajax?sousuo=" + name,
            success: function (data) {
                console.log(data);
                windowHeight = window.screen.height + 500;
                imgId = 0;
                //var msg=jQuery.parseJSON(data);
                //var newData = JSON.stringify(data);    //将json对象转换为字符串
                //    var jsonvalue = eval('(' + newData + ')');//接受的json格式有{}包着，如果不写，会把它理解为语句块
                //for (var i = 0; i < msg.length; i++) {
                //    console.log(msg[0].UserInfo.Info);
                //}
                goods = data;//将ajax获取到的数据存放到全局变量中
                insertImg();
            },
            error: function (e) {
                console.log(e.status);
                console.log(e.responseText);
            }
        })
    }


    //插入图片的算法
    var insertImg = function () {
        var msg = jQuery.parseJSON(goods);//那以后每次用的收都将goods转化为这个形式
        var inter = setInterval(function () { //就是给浏览器渲染图片的时间
            if (document.documentElement.scrollHeight > windowHeight || imgId > msg.length) { //达到预期的高度. 停止,或者所有数据加载完成
                clearInterval(inter);//停止定时器
            }
            console.log(imgId + ':' + msg.length);
            var mDiv = minDiv();
            //插入图片
            try {
                console.log(msg[imgId].Goodsimage[0].images);
                console.log("发生错误了,跳出计时器。error：" + imgId + "追加了")
                var parentdiv = $('<div class="thumbnail"><a href="/Goods/Index?id=' + msg[imgId].GoodsId + '"><img src="/images/img/' + msg[imgId].Goodsimage[0].images + '" /><div class="caption"><h3>' + msg[imgId].Name + '</h3><div><span class="monye_1">' + msg[imgId].Price + '</span><span style="color:gray;margin-left:10px;">长沙</span></div><p>' + msg[imgId].Info + '</p><hr /><div class="userinfo_sm"><img src="/images/img/' + msg[imgId].UserInfo.Images + '" />' + msg[imgId].UserInfo.UserName + '</div></div></a></div>');
                mDiv.append(parentdiv);
                imgId++;
            } catch (error) {
                console.log("发生错误了,跳出计时器。error：" + error)
                clearInterval(inter);//停止定时器
            }
        }, 100);//定时器, 每隔100毫秒. 运行一次function
    }
    /**
     * 当前哪一列是高度最小的
     */
    var minDiv = function () {
        var pb1 = $('#pubu-01 img');
        var pb2 = $('#pubu-02 img');
        var pb3 = $('#pubu-03 img');
        var pb4 = $('#pubu-04 img');

        var pb1Height = jisuan(pb1);
        var pb2Height = jisuan(pb2);
        var pb3Height = jisuan(pb3);
        var pb4Height = jisuan(pb4);

        var minHeight = Math.min(pb1Height, pb2Height, pb3Height, pb4Height);

        if (minHeight == pb1Height) {
            return $('#pubu-01');
        }
        if (minHeight == pb2Height) {
            return $('#pubu-02');
        }
        if (minHeight == pb3Height) {
            return $('#pubu-03');
        }
        if (minHeight == pb4Height) {
            return $('#pubu-04');
        }
    }
    var jisuan = function (pbImgs) {

        if (pbImgs == null || pbImgs.length == 0) {//这一列还没有图片
            return 0;
        } else {
            var height = 0;
            //获取到当前列每一个图片
            for (var i = 0; i < pbImgs.length; i++) {
                var img = pbImgs[i];
                var h = img.height;
                height += h;//累加
            }
            return height;
        }
    }

    var clerling = function () {
        $('#pubu-01').html("");
        $('#pubu-02').html("");
        $('#pubu-03').html("");
        $('#pubu-04').html("");
        console.log('已清空！');
    }
</script>



<div id="cebianlan">
    <div class="cbl_0">分类导航</div>
    <div class="cbl_1">
        <a href="/Goods/IndexTwo?typeid=1&page=1$Name=''" title="全新低价二手电脑！！(有全新的二手吗？？)">
            <img src="~/images/icopng/电脑.png" /> &nbsp;&nbsp;电脑
        </a>
    </div>
    <div class="cbl_1">
        <a href="/Goods/IndexTwo?typeid=2&page=1$Name=''" title="旧手机，旧平板，全部都能换不锈钢脸盆！！">
            <img src="~/images/icopng/手机.png" /> &nbsp;&nbsp;手机平板
        </a>
    </div>

    <div class="cbl_1">
        <a href="/Goods/IndexTwo?typeid=3&page=1$Name=''" title="工作中的小助手！！">
            <img src="~/images/icopng/u盘.png" /> &nbsp;&nbsp;办公用品
        </a>
    </div>
    <div class="cbl_1">
        <a href="/Goods/IndexTwo?typeid=4&page=1$Name=''" title="我们一直走在时尚的潮流（酷）！！">
            <img src="~/images/icopng/单反.png" /> &nbsp;&nbsp;数码产品
        </a>
    </div>
    <div class="cbl_1">
        <a href="/Goods/IndexTwo?typeid=5&page=1$Name=''" title="我们是你贴心小棉袄，哈哈！！">
            <img src="~/images/icopng/耳机.png" /> &nbsp;&nbsp;生活用品
        </a>
    </div>
    <div class="cbl_1">
        <a href="/Goods/IndexTwo?typeid=6&page=1$Name=''" title="爱读书的人，都是有大智慧的人啊！！">
            <img src="~/images/icopng/图书.png" /> &nbsp;&nbsp;图书
        </a>
    </div>

    <div class="cbl_1">
        <a href="/Goods/IndexTwo?typeid=7&page=1$Name=''" title="游戏账号，点券道具！！">
            <img src="~/images/icopng/游戏机.png" /> &nbsp;&nbsp;虚拟道具
        </a>
    </div>
    <div class="cbl_1">
        <a href="/Goods/IndexTwo?typeid=8&page=1$Name=''" title="其他奇奇怪怪的宝贝噢！！">
            <img src="~/images/icopng/vr.png" /> &nbsp;&nbsp;其他
        </a>
    </div>
</div>
<div id="toplan">
    <a href="#" title="回到顶部"><img src="~/images/img/5-120601155S5-50.png" /></a>
</div>


